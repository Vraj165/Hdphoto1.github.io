<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Photo â†’ HD (Mobile)</title>
<style>
  body { font-family: Arial, sans-serif; text-align:center; padding:18px; background:#f6f7fb; color:#111 }
  .card { max-width:720px; margin:0 auto; background:white; padding:16px; border-radius:10px; box-shadow:0 6px 18px rgba(20,20,40,0.06) }
  input, button { font-size:16px; padding:10px 12px; margin:8px; border-radius:8px; border:1px solid #ddd }
  button { background:#1976d2; color:white; border:none }
  img { max-width:100%; border-radius:8px; display:block; margin:10px auto }
  #spinner { display:none; margin:10px auto; }
  .note { font-size:13px; color:#555; margin-top:8px }
  a.download { display:inline-block; padding:10px 14px; margin-top:8px; background:#4caf50; color:white; text-decoration:none; border-radius:8px; }
</style>
</head>
<body>
  <div class="card">
    <h2>Turn Photo into HD</h2>
    <input id="file" type="file" accept="image/*">
    <div>
      <button id="enhance">Enhance to HD</button>
    </div>
    <div id="spinner">ðŸ”„ Enhancing... please wait</div>
    <img id="preview" src="" alt="preview" />
    <div class="note">Tip: Choose a clear photo for best results.</div>
    <a id="download" class="download" href="#" download="enhanced.png" style="display:none">Download HD Photo</a>
    <div class="note" style="margin-top:12px; font-size:13px; color:#b00">
      IMPORTANT: Replace <code>YOUR_DEEPAI_KEY</code> in the script below with your DeepAI API key.
    </div>
  </div>

<script>
const fileInput = document.getElementById('file');
const preview = document.getElementById('preview');
const enhanceBtn = document.getElementById('enhance');
const spinner = document.getElementById('spinner');
const downloadLink = document.getElementById('download');

let selectedFile = null;
fileInput.addEventListener('change', (e) => {
  selectedFile = e.target.files[0];
  if (!selectedFile) return;
  preview.src = URL.createObjectURL(selectedFile);
  downloadLink.style.display = 'none';
});

enhanceBtn.addEventListener('click', async () => {
  if (!selectedFile) { alert('Please choose a photo first.'); return; }

  // Disable UI
  enhanceBtn.disabled = true;
  spinner.style.display = 'block';

  const form = new FormData();
  form.append('image', selectedFile);

  try {
    // Replace this key with your real key
    const API_KEY = 'YOUR_DEEPAI_KEY';

    const resp = await fetch('https://api.deepai.org/api/torch-srgan', {
      method: 'POST',
      headers: { 'Api-Key': API_KEY },
      body: form
    });

    if (!resp.ok) {
      const txt = await resp.text();
      throw new Error('API error: ' + resp.status + ' ' + txt);
    }

    const data = await resp.json();
    if (!data || !data.output_url) throw new Error('No output_url in API response.');

    const hdUrl = data.output_url;

    // Try to fetch the image as blob (safer for cross-origin and for downloading)
    try {
      const imageResp = await fetch(hdUrl);
      if (!imageResp.ok) throw new Error('Failed to fetch HD image directly, using remote URL.');

      const blob = await imageResp.blob();
      const objectUrl = URL.createObjectURL(blob);
      preview.src = objectUrl;
      downloadLink.href = objectUrl;
      downloadLink.style.display = 'inline-block';
    } catch (errInner) {
      // If fetching as blob failed due to CORS, fall back to using remote URL
      console.warn('Could not fetch processed image as blob, using direct link:', errInner);
      preview.src = hdUrl;
      downloadLink.href = hdUrl;
      downloadLink.style.display = 'inline-block';
    }

  } catch (err) {
    console.error(err);
    alert('Enhance failed: ' + (err.message || err));
  } finally {
    spinner.style.display = 'none';
    enhanceBtn.disabled = false;
  }
});
</script>
</body>
</html>
